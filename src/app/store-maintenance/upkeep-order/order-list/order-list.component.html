<div class="content-header">
  <app-crumb [level1Name]="'保养订单'"></app-crumb>
</div>
<div class="content-flow">
  <div class="tab-bar-list">
    <nz-radio-group [nzButtonStyle]="'solid'">
      <label nz-radio-button>上门保养</label>
    </nz-radio-group>
  </div>
  <div class="table-container">
    <div class="search-container">
      <form class="search-form" autocomplete="off">
        <div class="form-group">
          <span>订单状态：</span>
          <select name="status" class="form-control" style="width: 130px;" [(ngModel)]="searchParams.order_status">
            <option value="">全部</option>
            <option value="1">待支付</option>
            <option value="2">待服务</option>
            <option value="3">已取消</option>
            <option value="4">已完成</option>
            <option value="5">已关闭</option>
          </select>
        </div>

        <div class="form-group">
          <span>手机号：</span>
          <input name="contact_tel" class="form-control" placeholder="请输入手机号" [(ngModel)]="searchParams.contact_tel"
            maxlength="11" appIntNumber>
        </div>
        <div class="form-group">
          <span>购买人：</span>
          <input name="contact_name" class="form-control" [(ngModel)]="searchParams.contact_name" placeholder="请输入购买人"
            maxlength="20" appIgnoreSpace />
        </div>
        <div class="form-group">
          <span>汽修店：</span>
          <input name="repair_shop_name" class="form-control" placeholder="请输入汽修店名称" maxlength="32"
            [(ngModel)]="searchParams.repair_shop_name" appIgnoreSpace />
        </div>
        <div class="form-group">
          <span>订单编号：</span>
          <input name="door_order_id" class="form-control" placeholder="请输入订单编号" maxlength="32"
            [(ngModel)]="searchParams.order_id" oninput="value=value.replace(/[^a-zA-Z0-9]/ig,'')" appIgnoreSpace />
        </div>
        <div class="form-group">
          <span>下单时间：</span>
          <nz-date-picker [(ngModel)]="order_start_time" [nzShowToday]=false [nzDisabledDate]="disabledOrderStartTime"
            name='order_start_time' [nzShowTime]="{'nzFormat':'HH:mm'}" nzFormat="yyyy-MM-dd HH:mm"></nz-date-picker>
          <span class='line'>-</span>
          <nz-date-picker [(ngModel)]="order_end_time" [nzShowToday]=false [nzDisabledDate]="disabledOrderEndTime"
            name='order_end_time' [nzShowTime]="{'nzFormat':'HH:mm'}" nzFormat="yyyy-MM-dd HH:mm"></nz-date-picker>
        </div>
        <div class="form-group">
          <span>支付时间：</span>
          <nz-date-picker [(ngModel)]="pay_start_time" [nzShowToday]=false [nzDisabledDate]="disabledStartPayTime"
            name='pay_start_time' [nzShowTime]="{'nzFormat':'HH:mm'}" nzFormat="yyyy-MM-dd HH:mm"></nz-date-picker>
          <span class='line'>-</span>
          <nz-date-picker [(ngModel)]="pay_end_time" [nzShowToday]=false [nzDisabledDate]="disabledEndPayTime"
            name='pay_end_time' [nzShowTime]="{'nzFormat':'HH:mm'}" nzFormat="yyyy-MM-dd HH:mm"></nz-date-picker>
          <div class="search-btn-group">
            <button nz-button nzType="primary" (click)="onSearchBtnClick()">查询
            </button>
          </div>
        </div>
      </form>
    </div>
    <div class="zmy-table">
      <nz-table [nzData]="orderList" [nzShowPagination]="true" [nzNoResult]="noResultText" [nzPageSize]="'15'"
        (nzPageIndexChange)="onNZPageIndexChange($event)" [(nzPageIndex)]="pageIndex" #rescueOrderTable>
        <thead>
          <tr>
            <th>序号</th>
            <th>订单编号</th>
            <th>购买人</th>
            <th style="width: 8%">车型</th>
            <th>汽修店</th>
            <th>配送地址</th>
            <th style="width: 15%">配件</th>
            <th>数量</th>
            <th>预付实收</th>
            <th>下单&支付时间</th>
            <th>订单状态</th>
            <th>售后/退款</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let order of rescueOrderTable.data; let i=index">
            <td>{{i+(pageIndex-1)*15+1}}</td>

            <td [title]="order.door_order_id?order.door_order_id:''">
              <span *ngIf="order.door_order_id" [appTxtCopy]="order.door_order_id">
                {{order.door_order_id|zMaxLength:10}}
              </span>
              <span *ngIf="!order.door_order_id">--</span>
            </td>

            <td>
              <div class="column-box">
                <ng-container *ngIf="order.contact_name || order.contact_tel">
                  <span [title]="order.contact_name || ''">{{order.contact_name | zMaxLength:6}}</span>
                  <span>{{order.contact_tel || ''}}</span>
                </ng-container>
                <ng-container *ngIf="!order.contact_name && !order.contact_tel">
                  <span>--</span>
                </ng-container>
              </div>
            </td>
            <td>{{order.car_model || '--'}}</td>
            <td>
              <ng-container *ngIf="order.repair_shop_district || order.repair_shop_name">
                <div class="column-box">
                  <span [title]="order.repair_shop_district || ''">{{order.repair_shop_district | zMaxLength:6}}</span>
                  <span [title]="order.repair_shop_name || ''">
                    {{order.repair_shop_name ? (order.repair_shop_name|zMaxLength:6) : ''}}</span>
                </div>
              </ng-container>
              <ng-container *ngIf="!order.repair_shop_district && !order.repair_shop_name">
                <span>--</span>
              </ng-container>
            </td>
            <td [title]="order.address || ''">{{order.address? (order.address|zMaxLength:6) : '--'}}</td>

            <td>
              <ng-container *ngIf="order.accessory_info">
                <div class="img-item">
                  <div class="img-box">
                    <ng-container *ngIf="order.accessory_info.accessory_images">
                      <ng-container
                        *ngFor="let image_url of order.accessory_info.accessory_images.split(',');let i=index">
                        <img *ngIf="i===0" src="{{image_url}}" />
                      </ng-container>
                    </ng-container>
                    <img *ngIf="!order.accessory_info.accessory_images" src="/assets/images/image_space.png" />
                  </div>
                  <div style="text-align: left;padding: 10px 0;">
                    <span [title]="order.accessory_info.accessory_name ||''"
                      style="word-break: keep-all;">{{order.accessory_info.accessory_name | zMaxLength:6}}</span>
                    <div class="match-info">
                      <img src="/assets/images/icon_match.png">
                      <!-- <label>已匹配</label> -->
                    </div>
                  </div>
                </div>
              </ng-container>
              <span *ngIf="!order.accessory_info">--</span>
            </td>

            <td>{{order.buy_num>=0 || '--'}}</td>

            <td>{{order.real_prepaid_fee | centPriceChange:'元'}}</td>

            <td>
              <div class="column-box">
                <span *ngIf="order.created_time">
                  {{order.created_time ?('下单：'+(order.created_time* 1000 | date:"y-MM-dd HH:mm")):''}}
                </span>
                <span *ngIf="order.pay_time">
                  {{order.pay_time ?('支付：'+(order.pay_time* 1000 | date:"y-MM-dd HH:mm")):''}}
                </span>
                <span *ngIf="!order.created_time && !order.pay_time">--</span>
              </div>
            </td>

            <td>{{order.order_status | doorOrderStatus}}</td>

            <td>
              <div class="column-box" *ngIf="order.refund_status>0">
                <span>{{order.refund_status | doorRefundStatus}}</span>
                <span *ngIf="order.door_refund_order">
                  {{'('+(order.door_refund_order.refund_status | doorRefundOrderStatus)+')'}}</span>
              </div>
              <span *ngIf="!order.refund_status">--</span>
            </td>

            <td class="operation">
              <div>
                <a [title]="'查看'" [routerLink]="['../order-detail', order.door_order_id]">查看</a>
                <a [title]="'人工匹配'" [routerLink]="['../order-detail', order.door_order_id]">人工匹配</a>
                <a *ngIf="(order.order_status===2 || order.order_status===4) && !order.refund_status" [title]="'退款'"
                  (click)="onRefundClick(order)">退款</a>
              </div>
            </td>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </div>
</div>