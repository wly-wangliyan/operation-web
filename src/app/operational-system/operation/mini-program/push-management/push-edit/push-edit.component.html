<!--新增/编辑Push-->
<div class="modal fade" id="editBannerModal" data-backdrop="false" data-keyboard="false" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true" #bannerPromptDiv>
    <div class="modal-dialog modal-dialog-common" role="document">
        <div class="modal-content modal-content-common">
            <div class="modal-header">
                <span class="modal-title">{{isCreatePush ? '新建' : '编辑'}}</span>
                <button type="button" class="close" data-dismiss="modal" (click)="onClose()">&times;
                </button>
            </div>
            <form *ngIf="pushParams" autocomplete="off" class="form-horizontal" id="form-horizontal" #editBannerForm="ngForm">
                <div class="row">
                    <label class="control-label">
                        <b>*</b>
                        <span>标题</span>
                    </label>
                    <div class="control-input">
                        <input class="form-control" placeholder="请输入1-20字标题" [(ngModel)]="pushParams.push_plan_name" name="push_plan_name"
                               maxlength="20" autocomplete="off" required appIgnoreSpace>
                    </div>
                </div>
                <div class="row">
                    <label class="control-label">
                        <b>*</b>
                        <span>推送优先级</span>
                    </label>
                    <div class="control-input">
                        <input class="form-control" placeholder="请输入1-100数值" [(ngModel)]="pushParams.push_plan_rank" style="width: 230px;margin-right: 20px"
                               maxlength="3" oninput="if(value&&value==0){value=1}else if(Number(value)>100){value=100}else{value=value.replace(/[^0-9]/ig,'')}"
                               name="push_plan_rank" autocomplete="off" required appIgnoreSpace>
                        <span>优先级数值越高则优先推送</span>
                    </div>
                </div>
                <div class="row">
                    <label class="control-label">
                        <b>*</b>
                        <span>定位人群</span>
                    </label>
                    <div class="control-input">
                        <a name="push_range1" class="offline-btn" [class.active-btn]="pushParams.push_range===1"
                           (click)="onChangeTeb('push_range', 1)">全部</a>
                        <a name="push_range2" class="offline-btn" [class.active-btn]="pushParams.push_range===2"
                           (click)="onChangeTeb('push_range', 2)" style="margin-right: 5px">领券未使用用户</a>
                    </div>
                    <div class="push-rate" *ngIf="pushParams.push_range===2">
                        <a name="range_type1" class="offline-btn" [class.active-btn]="pushParams.range_type===1"
                           (click)="onChangeTeb('range_type', 1)">指定优惠券模板ID</a>
                        <a name="range_type2" class="offline-btn" [class.active-btn]="pushParams.range_type===2"
                           (click)="onChangeTeb('range_type', 2)">指定优惠券组ID</a>
                        <a name="range_type3" class="offline-btn" [class.active-btn]="pushParams.range_type===3"
                           (click)="onChangeTeb('range_type', 3)" style="margin-right: 5px">指定优惠券服务业务</a>
                    </div>
                    <div class="push-rate location-crowd" style="margin-top: 10px">
                        <input *ngIf="pushParams.push_range===2&&pushParams.range_type===1" class="form-control" placeholder="请输入优惠券模板ID"
                               oninput="value=value.replace(/[^a-zA-Z0-9]/ig,'')"
                               [(ngModel)]="pushParams.coupon_id" maxlength="50" name="coupon_id" autocomplete="off" required appIgnoreSpace>
                        <input *ngIf="pushParams.push_range===2&&pushParams.range_type===2" class="form-control" placeholder="请输入优惠券组ID"
                               oninput="value=value.replace(/[^a-zA-Z0-9]/ig,'')"
                               [(ngModel)]="pushParams.coupon_group_id" maxlength="50" name="coupon_group_id" autocomplete="off" required appIgnoreSpace>
                        <select *ngIf="pushParams.push_range===2&&pushParams.range_type===3" class="form-control" [(ngModel)]="pushParams.coupon_service" name="coupon_service">
                            <option *ngFor="let item of coupon_service;let i=index" [value]=i>{{item}}</option>
                        </select>
                        <ng-container *ngIf="pushParams.push_range===2&&pushParams.range_type">
                            <span>距离到期</span>
                            <input class="form-control" [(ngModel)]="pushParams.date_limit" name="date_limit" maxlength="3" autocomplete="off"
                                   oninput="value=value.replace(/[^0-9]/ig,'')" placeholder="0-999" required appIgnoreSpace>
                            <label>日</label>
                            <span>以内显示推送</span>
                        </ng-container>
                    </div>
                </div>
                <div class="row">
                    <label class="control-label">
                        <b>*</b>
                        <span>推送频次</span>
                    </label>
                    <div class="control-input">
                        <a name="push_speed_type1" class="offline-btn" [class.active-btn]="pushParams.push_speed_type===1"
                           (click)="onChangeTeb('push_speed_type', 1)">触发后不再推送</a>
                        <a name="push_speed_type2" class="offline-btn" [class.active-btn]="pushParams.push_speed_type===2"
                           (click)="onChangeTeb('push_speed_type', 2)" style="margin-right: 5px">触发后持续推送</a>
                    </div>
                    <div class="push-rate" *ngIf="pushParams.push_speed_type===2">
                        <span>最小间隔</span>
                        <input class="form-control" [(ngModel)]="pushParams.push_interval" name="push_interval" placeholder="0-999"
                               maxlength="3" autocomplete="off" oninput="value=value.replace(/[^0-9]/ig,'')" required appIgnoreSpace>
                        <label>日</label>
                        <span>推送1次，最大推送</span>
                        <input class="form-control" [(ngModel)]="pushParams.push_num" name="push_num" placeholder="1-999" maxlength="3"
                               autocomplete="off" oninput="if(value&&value==0){value=1}else{value=value.replace(/[^0-9]/ig,'')}" required appIgnoreSpace>
                        <label>次</label>
                    </div>
                </div>
                <div class="row break-line"></div>
                <div class="row">
                    <label class="control-label">
                        <b>*</b>
                        <span>推送形式</span>
                    </label>
                    <div class="control-input">
                        <a name="push_type1" class="offline-btn" [class.active-btn]="pushParams.push_type===1"
                           (click)="onChangeTeb('push_type', 1)">首页浮窗</a>
                        <a name="push_type2" class="offline-btn" [class.active-btn]="pushParams.push_type===2"
                           (click)="onChangeTeb('push_type', 2)" style="margin-right: 5px">首页弹窗</a>
                    </div>
                </div>
                <div class="row">
                    <label class=" control-label">
                        <b>*</b>
                        <span>图片</span>
                    </label>
                    <div class="control-input">
                        <app-z-photo-select [hasAddPicture]="true" [hasDeletePicture]="true" [limitImgSize]="2" [imgReg]="imgReg"
                                            [isCutCoverImg]="false" (selectedImgChange)="onSelectedPicture($event)" file_id="coverImg"
                                            [imageWidth]="100" [imageHeight]="100" [imageUrls]="cover_url" #coverImg [aspectRatio]="1/1"
                                            [minCropBoxWidth]="300" [minCropBoxHeight]="300" [resizable]="true">
                        </app-z-photo-select>
                    </div>
                </div>
                <div class="row row-message">
                    <label class="control-label"></label>
                    <div class="control-input err-message">
                        <span *ngIf="errPositionItem?.icon?.isError">{{errPositionItem?.icon?.errMes}}</span>
                    </div>
                </div>
                <p *ngIf="pushParams.push_type===2||!pushParams.push_type" class="cover-hint">注：尺寸540 × 540px，格式PNG/JPG/GIF，大小2M以内</p>
                <p *ngIf="pushParams.push_type===1" class="cover-hint">注：尺寸120 × 120px，格式PNG/JPG/GIF，大小2M以内</p>
                <div class="row">
                    <label class=" control-label">
                        <b>&nbsp;</b>
                        <span>落地页</span>
                    </label>
                    <div class="control-input">
                        <select class="form-control" [(ngModel)]="pushParams.url_type" name="url_type">
                            <option [value]=0>请选择</option>
                            <option [value]=2>H5</option>
                            <option [value]=1>小程序原生页</option>
                        </select>
                        <input class="form-control" placeholder="请输入跳转URL" [(ngModel)]="pushParams.push_location_url" name="push_location_url"
                               maxlength="2000" autocomplete="off" appIgnoreSpace style="border-left: none!important;">
                    </div>
                </div>
                <div class="row break-line"></div>
                <!--<div class="row">
                    <label class="control-label">
                        <b>*</b>
                        <span>发布时间</span>
                    </label>
                    <div class="control-input">
                        <a name="online-btn" class="online-btn online-disabled" style="border: none">立即发布</a>
                    </div>
                </div>-->
                <div class="row">
                    <label class="control-label">
                        <b>*</b>
                        <span>下线时间</span>
                    </label>
                    <div class="control-input">
                        <a name="offline_status1" class="offline-btn" [class.active-btn]="offline_status===1"
                           (click)="onChangeTeb('offline_status', 1)">永不下线</a>
                        <a name="offline_status2" class="offline-btn" [class.active-btn]="offline_status===2"
                           (click)="onChangeTeb('offline_status', 2)" style="margin-right: 5px">定时下线</a>
                        <nz-date-picker *ngIf="offline_status===2" [(ngModel)]="pushParams.end_time"
                                        (ngModelChange)="errPositionItem.offline_time.isError=false" [nzShowToday]=false
                                        [nzDisabledDate]="disabledTime" name='end_time' [nzShowTime]="{'nzFormat':'HH:mm'}"
                                        nzFormat="yyyy-MM-dd HH:mm">
                        </nz-date-picker>
                    </div>
                </div>
                <div class="row row-message">
                    <label class="control-label"></label>
                    <div class="control-input err-message">
                        <span *ngIf="errPositionItem?.offline_time?.isError">{{errPositionItem?.offline_time?.errMes}}</span>
                    </div>
                </div>
                <div class="row">
                    <label class="control-label">
                        <b>&nbsp;&nbsp;</b>
                        <span>备注</span>
                    </label>
                    <div class="control-input">
            <textarea class="form-control" rows="4" placeholder="输入备注,100字以内" [(ngModel)]="pushParams.description"
                      name="description" maxlength="100">
            </textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="close-btn" type="button" nz-button (click)="onClose()">取消</button>
                    <button class="sure-btn" type="button" nz-button nzType="primary"
                            [disabled]="!editBannerForm.form.valid || coverImg.imageList.length===0 || offline_status === 2 && !pushParams.end_time
                             || (pushParams.coupon_service==0&&pushParams.push_range===3) || !pushParams.push_type || !pushParams.push_range ||
                             (!pushParams.range_type&&pushParams.push_range&&pushParams.push_range!==1) || !pushParams.push_speed_type ||
                             !offline_status || ((!pushParams.url_type||pushParams.url_type==0)&&pushParams.push_location_url) ||
                             (pushParams.url_type&&pushParams.url_type!=0&&!pushParams.push_location_url)"
                            (appZDebounceClick)="onEditFormSubmit()">{{sureName}}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
