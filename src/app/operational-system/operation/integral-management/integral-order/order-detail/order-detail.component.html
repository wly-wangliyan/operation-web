<div class="content-header">
  <app-crumb [level1Name]="'积分管理'" [level2Name]="'积分订单管理'" [level2RelativePath]="'../../../list'" [level3Name]="'订单详情'">
  </app-crumb>
</div>
<div class="content-flow" *ngIf="orderDetail.integral_order_id">
  <div class='des_card'>
    <nz-card nzTitle="" class="top-card">
      <div nz-card-grid class="leftTop-card">
        <!-- 虚拟商品 -->
        <div class="delivery-status">
          {{orderStepStatus | commodityDeliveryStatus}}
          <span *ngIf='orderStepStatus===orderStepStatus'><span class="line"></span>
            <ng-container *ngIf="commodityInfo[0]?.commodity_type===3&&orderDetail.delivery_status===4">
              ({{orderDetail.failed_template_ids.length===commodityInfo[0]?.template_coupon_ids.length&&
              orderDetail.failed_group_ids.length===commodityInfo[0]?.coupon_group_ids.length?'全部发货失败':'部分发货失败'}})
            </ng-container>
            <ng-container *ngIf="commodityInfo[0]?.commodity_type===3&&orderDetail.delivery_status!==4">
              发货成功
            </ng-container>
          </span>

        </div>
        <div style="margin: 20px 0 10px;">
          <div class="card-text">
            <label>订单编号：</label>
            <span>{{orderDetail.integral_order_id || '--'}}</span>
          </div>
          <div class="card-text">
            <label>下单时间：</label>
            <span>{{orderDetail.created_time ?(orderDetail.created_time* 1000 | date:"y-MM-dd HH:mm"):'--'}}</span>
          </div>
          <div class="card-text">
            <label>下单渠道：</label>
            <span>{{orderDetail.client_id?'美行停车小程序':'--'}}</span>
          </div>
        </div>
      </div>
      <div nz-card-grid class="rightTop-card">
        <div style="width: 67%;float: left; ">
          <!-- 未支付/已关闭（超时未支付） -->
          <div *ngIf="orderStepStatus===0||orderStepStatus===6">--</div>
          <!-- 待发货 -->
          <div *ngIf="orderStepStatus===1" class="card-content">客户已支付完成，尽快完成发货！</div>
          <!-- 虚拟商品：已发货 -->
          <div *ngIf="type==='2' && (orderStepStatus!==0&&orderStepStatus!==1&&orderStepStatus!==6)">
            <div class="card-title">
              无需配送
            </div>
            <div class="card-content">
              此订单商品为虚拟商品，无需配送！
            </div>
          </div>
          <!-- 实物商品--已发货（无需配送） -->
          <div *ngIf="type==='1' && orderStepStatus===3">
            <div class="card-title">
              无需配送
            </div>
            <div class="card-content">
              此订单无需物流配送，记得提醒买家确认收货！
            </div>
          </div>
        </div>
      </div>
      <div nz-card-grid class="leftBootm-card">
        <span class="remark_info" [title]="orderDetail.remark||''">
          <label style="width: 120px;">备注（平台）: </label>
          <span>{{(orderDetail.remark| zMaxLength:30) || '--'}}</span>
        </span>
        <button class='goods-btn' nz-button nzType="primary"
          (click)="onUpdateRemarkClick('备注（平台）',orderDetail)">编辑</button>
      </div>
    </nz-card>
    <nz-card nzTitle="" class="bottom-card">
      <div nz-card-grid>
        <div class="card-title">
          兑换信息
        </div>
        <div style="margin: 20px 0 10px;">
          <div class="card-text">
            <label>兑换积分：</label>
            <span>{{orderDetail.cost_integral || 0}}</span>
          </div>
          <div class="card-text">
            <label>兑换时间：</label>
            <span>{{orderDetail.pay_time?(orderDetail.pay_time * 1000 | date:'y-MM-dd HH:mm'):'--'}}</span>
          </div>
        </div>
      </div>
      <div nz-card-grid>
        <div class="card-title">
          收货人信息
        </div>
        <div style="margin: 20px 0 10px;">
          <div class="card-font">
            <label style="float: left;">联系人：</label>
            <span class="con-person">{{orderDetail.name||'--'}}</span>
            <a *ngIf="orderDetail.name" [appTxtCopy]='orderInfo'><img src="/assets/images/copy.png" /></a>
            <div style="clear: both;"></div>
          </div>
          <div class="card-text">
            <label>联系电话：</label>
            <span>{{orderDetail.telephone||'--'}}</span>
          </div>
        </div>
      </div>
    </nz-card>
  </div>
  <div class="table-item" style="margin-bottom: 30px;">
    <table class="detail-table">
      <caption>商品明细</caption>
      <thead>
        <tr>
          <th>商品名称</th>
          <th>类型</th>
          <th>数量</th>
          <th>兑换积分</th>
          <th>总积分</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let commodity of commodityInfo;let i=index">
          <ng-container>
            <td class="img-item">
              <img *ngIf="!commodity.commodity_images||commodity.commodity_images.length===0"
                src="/assets/images/image_space_3_2.png" />
              <img *ngIf="commodity.commodity_images&&commodity.commodity_images.length>0"
                src={{commodity.commodity_images[0]}} />
              <div style="display: grid;text-align: left;">
                <span [title]="commodity.commodity_name||''">{{commodity.commodity_name | zMaxLength:8}}</span>
              </div>
            </td>
          </ng-container>
          <ng-container *ngIf="!commodityInfo||commodityInfo.length===0">
            <td>
              <img src="/assets/images/image_space_3_2.png" />
            </td>
          </ng-container>
          <td>{{(commodity.commodity_type|integralCommodityType)||'--'}}</td>
          <td>{{commodity.amount||0}}</td>
          <td>
            {{commodity.integral_amount || 0}}
          </td>
          <td>
            {{orderDetail.cost_integral || 0}}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<app-order-remark #orderRemark></app-order-remark>