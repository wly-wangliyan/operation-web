<div class="content-header">
    <app-crumb [level1Name]="'产品订单'"></app-crumb>
</div>
<div class="content-flow">
    <div class="search-container">
        <form class="search-form">
            <div class="form-group">
                <span>订单状态：</span>
                <select class="form-control" style="width: 100px;" name="pay_status" [(ngModel)]="searchParams.pay_status">
                    <option value="">全部</option>
                    <option value="1">待支付</option>
                    <option value="2">已支付</option>
                    <option value="3">已取消</option>
                </select>
            </div>
            <div class="form-group">
                <span>发货状态：</span>
                <select class="form-control" style="width: 100px;" name="delivery_status" [(ngModel)]="searchParams.delivery_status">
                    <option value="">全部</option>
                    <option value="1">未发货</option>
                    <option value="2">已发货</option>
                    <option value="3">已收货</option>
                </select>
            </div>
            <div class="form-group">
                <span>购买手机号：</span>
                <input class="form-control" [(ngModel)]="searchParams.mobile" placeholder="请输入购买手机号" autocomplete="off"
                       name="mobile" maxlength="20" appIgnoreSpace />
            </div>
            <div class="form-group">
                <span>联系人：</span>
                <input class="form-control" [(ngModel)]="searchParams.contact" placeholder="请输入联系人" autocomplete="off"
                       name="contact" maxlength="32" appIgnoreSpace />
            </div>
            <div class="form-group">
                <span>产品名称：</span>
                <input class="form-control" [(ngModel)]="searchParams.commodity_name" placeholder="请输入产品名称" autocomplete="off"
                       name="commodity_name" maxlength="20" appIgnoreSpace />
            </div>
            <div class="form-group">
                <span>订单编号：</span>
                <input class="form-control" [(ngModel)]="searchParams.order_id" placeholder="请输入订单编号" autocomplete="off"
                       name="order_num" maxlength="32" appIgnoreSpace />
            </div>
            <div class="form-group">
                <span>下单时间：</span>
                <nz-date-picker [(ngModel)]="order_start_time" [nzShowToday]=false [nzDisabledDate]="disabledOrderStartTime"
                                name='order_start_time' [nzShowTime]="{'nzFormat':'HH:mm'}" nzFormat="yyyy-MM-dd HH:mm"></nz-date-picker>
                <span class='line'>-</span>
                <nz-date-picker [(ngModel)]="order_end_time" [nzShowToday]=false [nzDisabledDate]="disabledOrderEndTime"
                                name='order_end_time' [nzShowTime]="{'nzFormat':'HH:mm'}" nzFormat="yyyy-MM-dd HH:mm"></nz-date-picker>
            </div>
            <div class="form-group">
                <span>支付时间：</span>
                <nz-date-picker [(ngModel)]="pay_start_time" [nzShowToday]=false [nzDisabledDate]="disabledStartPayTime"
                                name='pay_start_time' [nzShowTime]="{'nzFormat':'HH:mm'}" nzFormat="yyyy-MM-dd HH:mm"></nz-date-picker>
                <span class='line'>-</span>
                <nz-date-picker [(ngModel)]="pay_end_time" [nzShowToday]=false [nzDisabledDate]="disabledEndPayTime"
                                name='pay_end_time' [nzShowTime]="{'nzFormat':'HH:mm'}" nzFormat="yyyy-MM-dd HH:mm"></nz-date-picker>
                <div class="search-btn-group">
                    <button nz-button nzType="primary" (click)="onSearchBtnClick()">查询
                    </button>
                </div>
            </div>
        </form>
    </div>
    <div class="table-container">
        <div class="zmy-table">
            <nz-table [nzData]="orderList" [nzShowPagination]="true" [nzNoResult]="noResultText" [nzPageSize]="'15'"
                      (nzPageIndexChange)="onNZPageIndexChange($event)" [(nzPageIndex)]="pageIndex" #goodsOrderTable>
                <thead>
                <tr>
                    <th>序号</th>
                    <th>订单编号</th>
                    <th>商品信息</th>
                    <th>数量</th>
                    <th>应收</th>
                    <th>平台立减</th>
                    <th>优惠券</th>
                    <th>实收</th>
                    <th>联系人</th>
                    <th>下单&支付时间</th>
                    <th>订单状态</th>
                    <th>发货状态</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let order of goodsOrderTable.data; let i=index">
                    <td>{{i+(pageIndex-1)*15+1}}</td>
                    <td [title]="order.order_id">{{order.order_id | zMaxLength:10}}</td>
                    <ng-container *ngIf="order.detail&&order.detail.length>0">
                        <td class="img-item" *ngFor="let commodity of order.detail">
                            <img *ngIf="!commodity.commodity_images||commodity.commodity_images.length===0" src="/assets/images/image_space_3_2.png" />
                            <img *ngIf="commodity.commodity_images&&commodity.commodity_images.length>0" src={{commodity.commodity_images[0]}} />
                            <div style="display: grid">
                                <a [title]="commodity.commodity_name"
                                   [routerLink]="['../../goods-management/detail', commodity.commodity_id]">
                                    {{commodity.commodity_name | zMaxLength:10}}</a>
                                <span [title]="commodity.specification_name">
                                        {{commodity.specification_name | zMaxLength:10}}</span>
                                <span>
                                    {{commodity.unit_sell_price?(commodity.unit_sell_price | centPriceChange)+'元':''}}
                                </span>
                            </div>
                        </td>
                    </ng-container>
                    <ng-container *ngIf="!order.detail||order.detail.length===0">
                        <td>
                            <img src="/assets/images/image_space_3_2.png" />
                        </td>
                    </ng-container>
                    <td>{{order.detail&&order.detail[0].amount?order.detail[0].amount:0}}</td>
                    <td>{{(order.total_amount||order.total_amount===0) ? ('￥ ' + (order.total_amount | centPriceChange)) : '--'}}
                    </td>
                    <td>
                        {{(order.discount_price	||order.discount_price===0) ? ('￥ ' + (order.discount_price | centPriceChange)) : '--'}}
                    </td>
                    <td>
                        {{(order.platform_coupon_amount||order.platform_coupon_amount===0) ? ('￥ ' + (order.platform_coupon_amount | centPriceChange)) : '--'}}
                    </td>
                    <td>{{(order.real_price||order.real_price===0) ? ('￥ ' + (order.real_price | centPriceChange)) : '--'}}</td>
                    <td>
                        <span [title]="order.contact">{{order.contact||order.mobile ? (order.contact|zMaxLength:6) : '--'}}</span>
                        <br *ngIf="order.contact"/>
                        <span>{{order.mobile}}</span>
                    </td>
                    <td>
                        <span *ngIf="!order.order_time&&!order.pay_time">--</span>
                        <span>
                            {{order.order_time?'下单：'+(order.order_time* 1000 | date:"y-MM-dd HH:mm"):''}}
                            <br *ngIf="order.order_time"/>
                            {{order.pay_time?'支付：'+(order.pay_time* 1000 | date:"y-MM-dd HH:mm"):''}}
                        </span>
                    </td>
                    <td>{{order.pay_status | orderPayStatus}}</td>
                    <td>{{order.delivery_status | deliveryStatus}}</td>
                    <td class="operation">
                        <a [title]="'查看'" [routerLink]="['../detail', order.order_id]">查看</a>
                        <a *ngIf="order.pay_status===2&&order.delivery_status===1" [title]="'发货'" (click)="onEditDeliveryClick(order)">发货</a>
                        <a *ngIf="order.delivery_status===2" [title]="'修改物流'" (click)="onEditDeliveryClick(order)">修改物流</a>
                        <a *ngIf="order.delivery_status===2" [title]="'确认收货'" (click)="onConfiemClick(order)">确认收货</a>
                    </td>
                </tr>
                </tbody>
            </nz-table>
        </div>
    </div>
</div>

<!--编辑物流信息-->
<app-goods-order-delivery #orderDeliveryComponent></app-goods-order-delivery>
